<div class="toolbar">
    <button class="toolbar-btn primary" type="button" (click)="openCreateModal()">Create</button>
    <button class="toolbar-btn primary" type="button" (click)="openFilterModal()">Filters</button>
    <button class="toolbar-btn" type="button" (click)="clearFilters()">Clear</button>
</div>

@if (appliedFilters.length > 0) {
<div class="applied-filters">
    @for (f of appliedFilters; track f.key) {
    <span class="filter-chip">
        <strong>{{ f.key }}</strong>: {{ f.value }}
    </span>
    }
</div>
}

@if (barcodes().length === 0) {
<div class="empty-state">No barcodes found.</div>
} @else {
<div class="table-container">
    <table class="barcode-table">
        <thead>
            <tr>
                <th (click)="sortBy('Id')" class="sortable">
                    ID<span class="sort-icon">{{ getSortIcon('Id') }}</span>
                </th>
                <th>Url.Code</th>
                <th>Url.OriginalUrl</th>

                <th (click)="sortBy('ScanCount')" class="sortable">
                    ScanCount<span class="sort-icon">{{ getSortIcon('ScanCount') }}</span>
                </th>

                <th>Tags</th>

                <th (click)="sortBy('CreatedAt')" class="sortable">
                    CreatedAt<span class="sort-icon">{{ getSortIcon('CreatedAt') }}</span>
                </th>

                <th>UpdatedAt</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            @for (b of barcodes(); track b.id) {
            <tr>
                <td class="id-cell"><a class="id-link" [routerLink]="['/barcodes', b.id]">{{ b.id }}</a></td>

                <td class="code-cell">
                    @if (b.url.code) {
                    <div class="code-wrapper">
                        <code>{{ b.url.code }}</code>
                        <button class="btn-copy" type="button" (click)="copyUrlCode(b.url.code)">
                            <fa-icon [icon]="faCopy"></fa-icon>
                        </button>
                    </div>
                    } @else {
                    <span>-</span>
                    }
                </td>

                <td class="url-cell">
                    @if (b.url.originalUrl) {
                    <a [href]="b.url.originalUrl" target="_blank" rel="noreferrer">
                        {{ b.url.originalUrl }}
                    </a>
                    } @else {
                    <span>-</span>
                    }
                </td>

                <td class="visits-cell">
                    <span class="visits-badge">{{ b.scanCount }}</span>
                </td>

                <td class="tags-cell">
                    @if (b.tags && b.tags.length > 0) {
                    <div class="tags">
                        @for (tag of b.tags; track tag) {
                        <span class="tag">{{ tag }}</span>
                        }
                    </div>
                    } @else {
                    <span>-</span>
                    }
                </td>

                <td class="date-cell">{{ formatDate(b.createdAt) }}</td>

                <td class="date-cell">
                    @if (b.updatedAt) {
                    {{ formatDate(b.updatedAt) }}
                    } @else {
                    <span>-</span>
                    }
                </td>

                <td class="actions-cell">
                    <button type="button" class="action-btn" title="Details (mock)" (click)="openDetails(b.id)">
                        <fa-icon [icon]="faEye"></fa-icon>
                    </button>

                    <button type="button" class="action-btn" title="Download" (click)="download(b.id)">
                        <fa-icon [icon]="faDownload"></fa-icon>
                    </button>

                    <button type="button" class="action-btn danger" title="Delete" (click)="openDeleteConfirm(b)">
                        <fa-icon [icon]="faTrash"></fa-icon>
                    </button>
                </td>
            </tr>
            }
        </tbody>
    </table>
</div>

<div class="pagination-container">
    <div class="pagination-info">
        Showing {{ rangeStart() }}-{{ rangeEnd() }} of {{ totalCount() }}
    </div>

    <div class="pagination-controls">
        <label class="page-size">
            Rows:
            <select [value]="pageSize()" (change)="setPageSize(($any($event.target)).value)">
                @for (size of pageSizeOptions; track size) {
                <option [value]="size">{{ size }}</option>
                }
            </select>
        </label>

        <button class="page-btn" type="button" (click)="prevPage()" [disabled]="!canGoPrev()">Prev</button>

        @for (page of pageNumbers; track page) {
        <button class="page-btn" type="button" [class.active]="page === currentPage()" (click)="goToPage(page)">
            {{ page }}
        </button>
        }

        <button class="page-btn" type="button" (click)="nextPage()" [disabled]="!canGoNext()">Next</button>
    </div>
</div>
}

<app-filter-modal [isOpen]="isFilterModalOpen()" [availableFilters]="availableFilters" (cancel)="closeFilterModal()"
    (apply)="applyFilters($event)">
</app-filter-modal>

<app-confirm-modal [isOpen]="confirmOpen()" [title]="confirmTitle()" [message]="confirmMessage()"
    [confirmText]="confirmConfirmText()" [confirmVariant]="confirmVariant()" (cancel)="closeConfirm()"
    (confirm)="confirmDelete()">
</app-confirm-modal>

<app-create-barcode-modal [isOpen]="isCreateModalOpen()" (cancel)="closeCreateModal()" (created)="onBarcodeCreated()">
</app-create-barcode-modal>