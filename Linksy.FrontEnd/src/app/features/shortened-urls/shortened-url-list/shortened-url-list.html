<div class="toolbar">
  <button class="toolbar-btn primary" type="button" (click)="openCreateModal()">Create</button>
  <button class="toolbar-btn primary" type="button" (click)="openFilterModal()">Filters</button>
  <button class="toolbar-btn" type="button" (click)="clearFilters()">Clear</button>
</div>
@if (appliedFilters.length > 0) {
<div class="applied-filters">
  @for (f of appliedFilters; track f.key) {
  <span class="filter-chip">
    <strong>{{ f.key }}</strong>: {{ f.value }}
  </span>
  }
</div>
}
@if (urls().length === 0) {
<div class="empty-state">No URLs found.</div>
} @else {
<div class="table-container">
  <table class="url-table">
    <thead>
      <tr>
        <th (click)="sortBy('Id')" class="sortable">
          ID<span class="sort-icon">{{ getSortIcon('Id') }}</span>
        </th>
        <th>Code</th>
        <th>Original URL</th>
        <th (click)="sortBy('VisitCount')" class="sortable">
          Visits<span class="sort-icon">{{ getSortIcon('VisitCount') }}</span>
        </th>
        <th>Status</th>
        <th>QR Code</th>
        <th>Barcode</th>
        <th>Landing Page</th>
        <th>UTM</th>
        <th>Tags</th>
        <th (click)="sortBy('CreatedAt')" class="sortable">
          Created<span class="sort-icon">{{ getSortIcon('CreatedAt') }}</span>
        </th>
        <th>Updated</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      @for (url of urls(); track url.id) {
      <tr>
        <td class="id-cell">
          <a class="id-link" [routerLink]="['/shortened-urls', url.id]">{{ url.id }}</a>
        </td>

        <td class="code-cell">
          <div class="code-wrapper">
            <code>{{ url.code }}</code>
            <button class="btn-copy" (click)="copyToClipboard(url.code)"><fa-icon [icon]="faCopy"></fa-icon></button>
          </div>
        </td>

        <td class="url-cell">
          @if (url.originalUrl) {
          <a [href]="url.originalUrl" target="_blank">
            {{ url.originalUrl }}
          </a>
          } @else {
          <span>-</span>
          }
        </td>

        <td class="visits-cell">
          <span class="visits-badge">{{ url.visitsCount }}</span>
        </td>

        <td class="status-cell">
          <span class="status-badge" [class.active]="url.isActive" [class.inactive]="!url.isActive">
            {{ url.isActive ? 'Active' : 'Inactive' }}
          </span>
        </td>

        <td class="flag-cell">
          <span class="flag-badge" [class.flag-true]="url.hasQrCode" [class.flag-false]="!url.hasQrCode">
            {{ url.hasQrCode ? 'True' : 'False' }}
          </span>
        </td>

        <td class="flag-cell">
          <span class="flag-badge" [class.flag-true]="url.hasBarcode" [class.flag-false]="!url.hasBarcode">
            {{ url.hasBarcode ? 'True' : 'False' }}
          </span>
        </td>

        <td class="flag-cell">
          <span class="flag-badge" [class.flag-true]="url.hasLandingPageItem"
            [class.flag-false]="!url.hasLandingPageItem">
            {{ url.hasLandingPageItem ? 'True' : 'False' }}
          </span>
        </td>

        <td class="flag-cell">
          <span class="flag-badge" [class.flag-true]="url.hasUmtParameter" [class.flag-false]="!url.hasUmtParameter">
            {{ url.hasUmtParameter ? 'True' : 'False' }}
          </span>
        </td>

        <td class="tags-cell">
          @if (url.tags && url.tags.length > 0) {
          <div class="tags">
            @for (tag of url.tags; track tag) {
            <span class="tag">{{ tag }}</span>
            }
          </div>
          } @else {
          <span>-</span>
          }
        </td>

        <td class="date-cell">
          {{ formatDate(url.createdAt) }}
        </td>

        <td class="date-cell">
          @if (url.updatedAt) {
          {{ formatDate(url.updatedAt) }}
          } @else {
          <span>-</span>
          }
        </td>
        <td class="actions-cell">
          <button type="button" class="action-btn" title="Shortened URL details" (click)="openDetails(url.id)">
            <fa-icon [icon]="faEye"></fa-icon>
          </button>
          <button type="button" class="action-btn" title="Toggle active" (click)="openToggleActiveConfirm(url)">
            <fa-icon [icon]="faUpload"></fa-icon>
          </button>

          <button type="button" class="action-btn danger" title="Delete Shortened URL" (click)="openDeleteConfirm(url)">
            <fa-icon [icon]="faTrash"></fa-icon>
          </button>
        </td>
      </tr>
      }
    </tbody>
  </table>
</div>
<div class="pagination-container">
  <div class="pagination-info">
    Showing {{ rangeStart() }}-{{ rangeEnd() }} of {{ totalCount() }}
  </div>

  <div class="pagination-controls">
    <label class="page-size">
      Rows:
      <select [value]="pageSize()" (change)="setPageSize(($any($event.target)).value)">
        @for (size of pageSizeOptions; track size) {
        <option [value]="size">{{ size }}</option>
        }
      </select>
    </label>

    <button class="page-btn" type="button" (click)="prevPage()" [disabled]="!canGoPrev()">
      Prev
    </button>

    @for (page of pageNumbers; track page) {
    <button class="page-btn" type="button" [class.active]="page === currentPage()" (click)="goToPage(page)">
      {{ page }}
    </button>
    }

    <button class="page-btn" type="button" (click)="nextPage()" [disabled]="!canGoNext()">
      Next
    </button>
  </div>
</div>
}
<app-filter-modal [isOpen]="isFilterModalOpen()" [availableFilters]="availableFilters" (cancel)="closeFilterModal()"
  (apply)="applyFilters($event)"></app-filter-modal>
<app-confirm-modal [isOpen]="confirmOpen()" [title]="confirmTitle()" [message]="confirmMessage()"
  [confirmText]="confirmConfirmText()" [confirmVariant]="confirmVariant()" (cancel)="closeConfirm()"
  (confirm)="confirmAction()"></app-confirm-modal>
<app-create-shortened-url-modal [isOpen]="isCreateModalOpen()" (cancel)="closeCreateModal()" (created)="onUrlCreated()">
</app-create-shortened-url-modal>